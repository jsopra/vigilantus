#!/usr/bin/env sh

echo "ğŸ‘¾ Verificando composer..."
command -v composer > /dev/null 2>&1 || echo >&2 "ğŸš« O composer nÃ£o estÃ¡ instalado ou nÃ£o estÃ¡ no \$PATH."

echo "ğŸ‘¾ Verificando composer-asset-plugin..."
(composer global show --installed 2> /dev/null | grep "fxp/composer-asset-plugin" > /dev/null 2>&1) || (echo "NÃ£o encontrado, instalando..." && composer global require "fxp/composer-asset-plugin:~1.0")

echo "ğŸ‘¾ Verificando arquivo de configuraÃ§Ã£o..."
if [ ! -f .env ]; then
    echo "ğŸš« Crie um arquivo \".env\" a partir do \".env.example\" e altere suas configuraÃ§Ãµes"
    exit 1
fi

echo "ğŸ‘¾ Instalando pacotes do composer..."
composer install -q || echo "ğŸš« Ocorreu um erro ao instalar os pacotes. Rode manualmente para ver o problema."

echo "ğŸ‘¾ Rodando migrations..."
php yii migrate --interactive=0 > /dev/null 2>&1 || echo "ğŸš« Ocorreu um erro ao rodar as migrations. Rode manualmente para ver o problema."

echo "ğŸ‘¾ Feito!"
