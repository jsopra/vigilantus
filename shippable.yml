language: php

php:
  - 5.5

services:
  - redis

addons:
  postgresql: "9.3"

before_install:
  # - sudo apt-get update
  - composer self-update
  - composer install --prefer-source --no-interaction --optimize-autoloader
  # - composer require "alanwillms/php-hound"

before_script:
  - pecl install redis
  # - pecl install xdebug
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage

script:
  - export ENVIRONMENT="development"
  - export VIGILANTUS_DB_DSN
  - export VIGILANTUS_DB_DSN_HOST
  - export VIGILANTUS_DB_DSN_DBNAME
  - export VIGILANTUS_DB_USERNAME
  - export VIGILANTUS_DB_PASSWORD
  - export VIGILANTUS_TEST_DB_DSN_HOST
  - export VIGILANTUS_TEST_DB_DSN_DBNAME
  - export VIGILANTUS_TEST_DB_USERNAME
  - export VIGILANTUS_TEST_DB_PASSWORD
  - export VIGILANTUS_REDIS_HOST
  - export VIGILANTUS_REDIS_DB_PORT
  - export VIGILANTUS_REDIS_DB_PASSWORD
  - export VIGILANTUS_REDIS_DB_NUMBER
  - psql -c 'DROP DATABASE IF EXISTS vigilantus_test;' -U postgres
  - psql -c 'CREATE DATABASE vigilantus_test;' -U postgres
  - ./tests/codeception/bin/yii migrate --interactive=0
  - "cd tests && ../vendor/bin/codecept run unit --xml='../../../shippable/testresults/report.xml' --coverage-xml='../../../shippable/codecoverage/coverage.xml'"
  # - ./vendor/bin/php-hound .

notifications:
  email: true
