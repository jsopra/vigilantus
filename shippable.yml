language: php

php:
  - 5.5

services:
  - redis

addons:
  postgresql: "9.3"

before_install:
  - sudo apt-get update
  - composer self-update
  - composer install --prefer-source --no-interaction --optimize-autoloader
  - composer require "alanwillms/php-hound"

before_script:
  - pecl install redis
  - pecl install xdebug
  - mkdir -p shippable/testresults

script:
  - export ENVIRONMENT="development"
  - export VIGILANTUS_DB_DSN="pgsql:host=localhost;dbname=vigilantus_development"
  - export VIGILANTUS_DB_DSN_HOST="pgsql:host=localhost"
  - export VIGILANTUS_DB_DSN_DBNAME="dbname=vigilantus_development"
  - export VIGILANTUS_DB_DSN="pgsql:host=localhost;dbname=vigilantus_development"
  - export VIGILANTUS_DB_USERNAME="postgres"
  - export VIGILANTUS_DB_PASSWORD="postgres"
  - export VIGILANTUS_TEST_DB_DSN_HOST="pgsql:host=localhost"
  - export VIGILANTUS_TEST_DB_DSN_DBNAME="dbname=vigilantus_test"
  - export VIGILANTUS_TEST_DB_USERNAME="postgres"
  - export VIGILANTUS_TEST_DB_PASSWORD="postgres"
  - export VIGILANTUS_REDIS_HOST="localhost"
  - export VIGILANTUS_REDIS_DB_PORT="6379"
  - export VIGILANTUS_REDIS_DB_PASSWORD=""
  - export VIGILANTUS_REDIS_DB_NUMBER="0"
  - psql -c 'DROP DATABASE IF EXISTS vigilantus_test;' -U postgres
  - psql -c 'CREATE DATABASE vigilantus_test;' -U postgres
  - "php yii migrate --interactive=0"
  - "cd tests && ../vendor/bin/codecept run unit"
  - ./vendor/bin/php-hound .

notifications:
  email: true